System.register("chunks:///_virtual/HouseFactory.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShadowDrawer.ts"],(function(e){"use strict";var t,o,r,n,s,a,i,u,c,h,f,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,o=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized},function(e){s=e.cclegacy,a=e._decorator,i=e.EventTarget,u=e.Prefab,c=e.Component,h=e.instantiate},function(e){f=e.shadowDrawerEventTarget,p=e.ShadowDrawerEvent}],execute:function(){var l,d,_,y,g,v;s._RF.push({},"429c9Uamr1JUpO90LpIrSkF","HouseFactory",void 0);var H=a.ccclass,b=a.property,E=e("houseFactoryEventTarget",new i),m=e("HouseFactoryEvent",{REBUILD_HOUSES:"generateHouses"});e("HouseFactory",(l=H("HouseFactory"),d=b({type:[u]}),l((g=t((y=function(e){function t(){for(var t,o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return t=e.call.apply(e,[this].concat(s))||this,r(t,"prefabs",g,n(t)),r(t,"houseCount",v,n(t)),t._houses=[],t}o(t,e);var s=t.prototype;return s.onLoad=function(){this._generateHouses(),E.on(m.REBUILD_HOUSES,this.onRebuildHouses,this)},s._getRandomPlace=function(e){return Math.floor(Math.random()*e-e/2)},s._generateHouses=function(){var e=this;this.node.children.forEach((function(e){return e.destroy()})),this._houses=[];for(var t=2*Math.ceil(Math.sqrt(this.houseCount)),o=0,r=function(){var r=e._getRandomPlace(t),n=e._getRandomPlace(t),s=void 0!==e._houses.find((function(e){return e.x===r&&e.y===n}));if(0!==r&&0!==n&&!s){var a=e.prefabs[Math.floor(Math.random()*e.prefabs.length)];e._houses.push({node:h(a),x:r,y:n,posX:80*(r-n),posY:-40*(r+n)}),o++}};o<this.houseCount;)r();this._houses.sort((function(e,t){return t.posY-e.posY})),this._houses.forEach((function(t){t.node.setPosition(t.posX,t.posY),t.node.setParent(e.node)})),f.emit(p.REDRAW_SHADOW)},s.onRebuildHouses=function(){f.emit(p.CLEAR_SHADOW_OBJECTS),this._generateHouses()},t}(c)).prototype,"prefabs",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v=t(y.prototype,"houseCount",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),_=y))||_));s._RF.pop()}}}));

System.register("chunks:///_virtual/InputHandler.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShadowDrawer.ts"],(function(t){"use strict";var n,o,e,r,a,s,h,i,u,c;return{setters:[function(t){n=t.inheritsLoose},function(t){o=t.cclegacy,e=t._decorator,r=t.UITransform,a=t.input,s=t.Input,h=t.v2,i=t.Component},function(t){u=t.shadowDrawerEventTarget,c=t.ShadowDrawerEvent}],execute:function(){var l;o._RF.push({},"586dfw+E1ZHwrsfKP5k2G3o","InputHandler",void 0);var p=e.ccclass;e.property,t("InputHandler",p("InputHandler")(l=function(t){function o(){for(var n,o=arguments.length,e=new Array(o),r=0;r<o;r++)e[r]=arguments[r];return(n=t.call.apply(t,[this].concat(e))||this)._shadowLength=30,n._shadowAngle=0,n._transform=null,n}n(o,t);var e=o.prototype;return e.start=function(){this._transform=this.getComponent(r),a.on(s.EventType.MOUSE_MOVE,this.onMouseMove,this)},e.onMouseMove=function(t){var n=this._transform.contentSize,o=t.getLocation(),e=h(o.x-n.width/2,o.y-n.height/2),r=Math.hypot(e.x,e.y)/7,a=180+Math.floor(180*Math.atan2(e.y,e.x)/Math.PI);a===this._shadowAngle&&a===this._shadowAngle||(this._shadowLength=r,this._shadowAngle=a,u.emit(c.REDRAW_SHADOW,this._shadowAngle,this._shadowLength))},o}(i))||l);o._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./HouseFactory.ts","./InputHandler.ts","./RebuildButton.ts","./ShadowCamera.ts","./ShadowDrawer.ts","./ShadowOwner.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/RebuildButton.ts",["./rollupPluginModLoBabelHelpers.js","cc","./HouseFactory.ts"],(function(t){"use strict";var o,e,n,u,r,c,i;return{setters:[function(t){o=t.inheritsLoose},function(t){e=t.cclegacy,n=t._decorator,u=t.Node,r=t.Component},function(t){c=t.houseFactoryEventTarget,i=t.HouseFactoryEvent}],execute:function(){var s;e._RF.push({},"54a090Qd61H8JOWIFJWUmvv","RebuildButton",void 0);var a=n.ccclass;n.property,t("RebuildButton",a("RebuildButton")(s=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.start=function(){this.node.on(u.EventType.TOUCH_START,this.onTouchStart,this)},n.onTouchStart=function(){c.emit(i.REBUILD_HOUSES)},e}(r))||s);e._RF.pop()}}}));

System.register("chunks:///_virtual/ShadowCamera.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,i,o,r,n,s,a,h,c;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,o=t._decorator,r=t.EventTarget,n=t.view,s=t.Rect,a=t.size,h=t.UITransform,c=t.Camera}],execute:function(){var d;i._RF.push({},"e35e3AdLfZLFZ2hWcXsEN39","ShadowCamera",void 0);var u=o.ccclass,l=(o.property,t("shadowCameraEventTarget",new r)),f=t("ShadowCameraEvent",{STICK_NODE_TO_CAMERA:"stickNodeToCamera"});t("ShadowCamera",u("ShadowCamera")(d=function(t){function i(){for(var e,i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this)._transform=null,e}e(i,t);var o=i.prototype;return o.onLoad=function(){t.prototype.onLoad.call(this),this.enabled&&(this.targetTexture?(n.on("canvas-resize",this.onCanvasResize,this),l.on(f.STICK_NODE_TO_CAMERA,this.onStickNodeToCamera,this)):this.enabled=!1)},o.start=function(){this.onCanvasResize()},o.getVisibleRect=function(){var t=n.getVisibleSize(),e=t.width/t.height,i=this.node.worldPosition,o=2*this.orthoHeight,r=e*o;return new s(i.x-.5*r,i.y-.5*o,r,o)},o.onCanvasResize=function(){var t=this.getVisibleRect();if(this.targetTexture.resize(t.width,t.height),this._transform){var e=a(t.width,t.height);this._transform.setContentSize(e)}},o.onStickNodeToCamera=function(t,e){this._transform=t.getComponent(h),this._transform.setContentSize(this.camera.width,this.camera.height),this.orthoHeight=this._transform.height/2;var i=this.node.getWorldPosition(),o=t.getWorldPosition();this.node.setWorldPosition(o.x,o.y,i.z),this.targetTexture.resize(this._transform.width,this._transform.height),e instanceof Function&&e(this.targetTexture)},i}(c))||d);i._RF.pop()}}}));

System.register("chunks:///_virtual/ShadowDrawer.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShadowCamera.ts"],(function(e){"use strict";var t,r,i,o,a,n,s,h,l,c,d,u,w,f,p,_,S,b,y,E,g;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.initializerDefineProperty,i=e.inheritsLoose,o=e.assertThisInitialized},function(e){a=e.cclegacy,n=e._decorator,s=e.EventTarget,h=e.EffectAsset,l=e.Graphics,c=e.Node,d=e.Layers,u=e.Sprite,w=e.SpriteFrame,f=e.v2,p=e.Vec2,_=e.Intersection2D,S=e.Material,b=e.Component,y=e.Color},function(e){E=e.shadowCameraEventTarget,g=e.ShadowCameraEvent}],execute:function(){var v,m,R,C,D,G,A,k,O,T,M,P,z,I,L,W,B,x;a._RF.push({},"58a7babm2FIDZ4A1D9o+Bkv","ShadowDrawer",void 0);var N=n.ccclass,j=n.property,H=e("shadowDrawerEventTarget",new s),F=e("ShadowDrawerEvent",{REGISTER_SHADOW_OBJECT:"registerShadowObject",REDRAW_SHADOW:"redrawShadow",CLEAR_SHADOW_OBJECTS:"clearShadowObjects"}),J=N("ShadowRender")((R=t((m=function(e,t){r(this,"owner",R,this),r(this,"points",C,this),r(this,"scale",D,this),this.owner=e,this.points=t,this.scale=e.shadowScale}).prototype,"owner",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(m.prototype,"points",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D=t(m.prototype,"scale",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),v=m))||v;e("ShadowDrawer",(G=N("ShadowDrawer"),A=j({type:h}),k=j({type:h}),O=j({type:h}),G((P=t((M=function(e){function t(){for(var t,i=arguments.length,a=new Array(i),n=0;n<i;n++)a[n]=arguments[n];return t=e.call.apply(e,[this].concat(a))||this,r(t,"shadowColor",P,o(t)),r(t,"shadowAngle",z,o(t)),r(t,"shadowLength",I,o(t)),r(t,"shadowBlurWidth",L,o(t)),r(t,"fillEffect",W,o(t)),r(t,"strokeEffect",B,o(t)),r(t,"renderEffect",x,o(t)),t._shadowRenders=[],t._fillGraphics=null,t._strokeGraphics=null,t}i(t,e);var a=t.prototype;return a.onLoad=function(){this._fillGraphics=this._createGraphics("FillNode",this.fillEffect),this._strokeGraphics=this._createGraphics("StrokeNode",this.strokeEffect),this._strokeGraphics.lineWidth=this.shadowBlurWidth,this._strokeGraphics.lineJoin=l.LineJoin.ROUND,H.on(F.REGISTER_SHADOW_OBJECT,this.onRegisterShadowObject,this),H.on(F.REDRAW_SHADOW,this.onRedrawShadow,this),H.on(F.CLEAR_SHADOW_OBJECTS,this.onClearShadowObjects,this)},a.start=function(){this._createRenderNode(),this._drawShadow()},a._createGraphics=function(e,t){var r=new c(e),i=r.addComponent(l);return i.strokeColor=this.shadowColor,i.fillColor=this.shadowColor,r.layer=d.Enum.shadow,r.setParent(this.node),this._setShadowMaterial(i,t),i},a._createRenderNode=function(){var e=this,t=new c("RenderNode");t.layer=d.Enum.UI_2D,t.setParent(this.node);var r=t.addComponent(u);E.emit(g.STICK_NODE_TO_CAMERA,t,(function(t){var i=new w;i.texture=t,r.spriteFrame=i,e._setShadowMaterial(r,e.renderEffect)}))},a._drawShadow=function(){var e=this,t=this.shadowAngle*(Math.PI/180);this._fillGraphics.clear(),this._strokeGraphics.clear(),this._shadowRenders.forEach((function(r){var i=[],o=f(0,0),a=f(0,0),n=f(Math.cos(t)*e.shadowLength*r.scale,Math.sin(t)*e.shadowLength/2*r.scale),s=r.points.map((function(e){return e.clone().add(n)}));r.points.forEach((function(t,a){e._checkPointInShadow(r.points,a,s,i),o=o.add(t)})),s.forEach((function(t,o){e._checkPointInShadow(s,o,r.points,i),a=a.add(t)})),o=o.multiplyScalar(1/r.points.length),a=a.multiplyScalar(1/s.length);var h=o.lerp(a,.5);i.sort((function(e,t){var r=p.subtract(f(),e,h),i=p.subtract(f(),t,h);return Math.atan2(r.y,r.x)-Math.atan2(i.y,i.x)})),e._fillGraphics.moveTo(i[0].x,i[0].y),e._strokeGraphics.moveTo(i[0].x,i[0].y);for(var l=1;l<i.length;l++)e._fillGraphics.lineTo(i[l].x,i[l].y),e._strokeGraphics.lineTo(i[l].x,i[l].y);e._fillGraphics.fill(),e._strokeGraphics.lineTo(i[0].x,i[0].y),e._strokeGraphics.stroke()}))},a._checkPointInShadow=function(e,t,r,i){var o=e[t],a=r[t],n=e.reduce((function(e,t){return e.push(t.equals(o)?a:t),e}),[]);_.pointInPolygon(o,n)||i.push(o)},a._setShadowMaterial=function(e,t){if(e&&t){var r=new S;r.initialize({effectAsset:t,defines:{USE_RGBE_CUBEMAP:!0}}),e.setMaterial(r,0),void 0!==e.sharedMaterial.getProperty("shadowColor")&&e.sharedMaterial.setProperty("shadowColor",this.shadowColor),e.updateRenderer()}},a.onRegisterShadowObject=function(e,t){var r=this,i=t.map((function(e){return e.subtract(f(r.node.worldPosition.x,r.node.worldPosition.y))}));this._shadowRenders.push(new J(e,i))},a.onRedrawShadow=function(e,t){void 0!==e&&(this.shadowAngle=e),void 0!==t&&(this.shadowLength=t),this._drawShadow()},a.onClearShadowObjects=function(){this._shadowRenders=[],this._drawShadow()},t}(b)).prototype,"shadowColor",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y(0,0,0)}}),z=t(M.prototype,"shadowAngle",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),I=t(M.prototype,"shadowLength",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),L=t(M.prototype,"shadowBlurWidth",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),W=t(M.prototype,"fillEffect",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=t(M.prototype,"strokeEffect",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(M.prototype,"renderEffect",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=M))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/ShadowOwner.ts",["./rollupPluginModLoBabelHelpers.js","cc","./ShadowDrawer.ts"],(function(e){"use strict";var o,t,r,i,n,a,l,s,c,d,h;return{setters:[function(e){o=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){n=e.cclegacy,a=e._decorator,l=e.PolygonCollider2D,s=e.v2,c=e.Component},function(e){d=e.shadowDrawerEventTarget,h=e.ShadowDrawerEvent}],execute:function(){var u,p,w;n._RF.push({},"2022dIqRIZE1K8gyVBRRitM","ShadowOwner",void 0);var y=a.ccclass,f=a.property,_=a.requireComponent;e("ShadowOwner",y("ShadowOwner")(u=_(l)((w=o((p=function(e){function o(){for(var o,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return o=e.call.apply(e,[this].concat(n))||this,r(o,"shadowScale",w,i(o)),o._collider=null,o}return t(o,e),o.prototype.onLoad=function(){var e=this;if(this._collider=this.getComponent(l),this._collider){this._collider.sensor=!0,this._collider.apply();var o=s(this.node.worldPosition.x,this.node.worldPosition.y),t=this._collider.offset,r=s(t.x*this.node.scale.x,t.y*this.node.scale.y),i=this._collider.points.map((function(t){var i=s(t.x*e.node.scale.x,t.y*e.node.scale.y);return o.clone().add(i).add(r)}));d.emit(h.REGISTER_SHADOW_OBJECT,this,i)}},o}(c)).prototype,"shadowScale",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),u=p))||u)||u);n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});